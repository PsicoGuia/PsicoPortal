<!--
  Generated template for the ContactModal page.

  See http://ionicframework.com/docs/components/#navigation for more info on
  Ionic pages and navigation.
-->
<ion-header>

  <ion-navbar color='primary'>
    <ion-title>THE SMOKERS STORE</ion-title>
    <ion-buttons end>
      <button ion-button clear (click)="closeModal()">
        <ion-icon name="md-close" color="light"></ion-icon>
      </button>
    </ion-buttons>
  </ion-navbar>

</ion-header>

<ion-content padding>

  <div class="loading-in-line" *ngIf="loading">
    <ion-spinner></ion-spinner>
  </div>

  <h3>{{ "CONTACTO" }}</h3>
  <div class="log" *ngIf='addresses'>
    <div *ngIf='currentAddress'>
      <h5>Mi Dirección</h5>    
      <ion-card>
        <ion-item-divider>
          <ion-label><b>Colombia - {{currentAddress.nameCity}}</b></ion-label>
        </ion-item-divider>
        <ion-item>
          <h2>{{currentAddress.address}}</h2>
          <p>{{currentAddress.notes}}</p>
        </ion-item>
      </ion-card>
    </div>
    <div *ngIf='point_max' margin-top margin-bottom>
      <h5 style="margin-bottom: 10px">Tienes puntos disponibles!</h5>
      <ion-item padding>
        <ion-label>Puntos a usar: <ion-icon name="logo-usd" color="secondary"> {{points | number:'3.2'}}</ion-icon></ion-label>
        <ion-range min="{{point_min}}" max="{{point_max - discount}}" step="{{point_steps}}" [(ngModel)]="points" color="secondary">
          <ion-label range-left>${{point_min}}</ion-label>
          <ion-label range-right>${{point_max | number:'3.2'}}</ion-label>
        </ion-range>
      </ion-item>
    </div>
  </div>

  <div class="NoLog" *ngIf='!addresses'>
    <div padding *ngIf="!loading">
      <h5>No has ingresado?</h5>
      <ion-grid>
        <ion-row>
          <ion-col>
            <button ion-button block (click)='login()' color="secondary">
              Iniciar sesión
            </button>
          </ion-col>
          <ion-col>
            <button ion-button block (click)="openPage({component: 'Register'})" color="secondary">
              Registrate
            </button>
          </ion-col>
        </ion-row>
      </ion-grid>
      <ion-list>

        <ion-item>
          <ion-label stacked>Nombre</ion-label>
          <ion-input type="text" [(ngModel)]="formdata.name"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label stacked>Correo Electrónico</ion-label>
          <ion-input type="email" [(ngModel)]="formdata.email"></ion-input>
        </ion-item>

        <ion-item>
          <ion-label stacked>País</ion-label>
          <ion-input type="text" disabled value="Colombia"></ion-input>
        </ion-item>


        <div class="autocomplete" *ngIf="!selectCity">
	         <ion-searchbar
             #mainSearchbar
		         [(ngModel)]="searchText"
             placeholder="Ciudad"
		         (ionInput)="getItems($event)"
             (ionClear)="clearSearch()"
		         debounce=500
             (keydown)='pressKey($event.keyCode)'>
	         </ion-searchbar>
	          <ion-list *ngIf="_flagClear">
		            <ion-item *ngIf="citys.length >= 1" [ngClass]="{active: (_activeSearch == 0)}" (click)="setCity(citys[0])">
			               {{citys[0]}}
		            </ion-item>
                <ion-item *ngIf="citys.length >= 2" [ngClass]="{active: (_activeSearch == 1)}" (click)="setCity(citys[1])">
			               {{citys[1]}}
		            </ion-item>
                <ion-item *ngIf="citys.length >= 3" [ngClass]="{active: (_activeSearch == 2)}" (click)="setCity(citys[2])">
			               {{citys[2]}}
		            </ion-item>
	         </ion-list>
         </div>

         <ion-item *ngIf="selectCity && !_flagSelectedCity" (click)="noCity()">
           <ion-label stacked>Ciudad</ion-label>
           <ion-input type="text" disabled value="{{selectCity.name}}"></ion-input>
         </ion-item>

         <ion-item *ngIf="selectCity && _flagSelectedCity">
          <ion-label stacked>Ciudad</ion-label>
          <ion-input type="text" disabled value="{{selectCity.name}}"></ion-input>
        </ion-item>


         <ion-item>
           <ion-label stacked>Dirección</ion-label>
           <ion-input type="text" [(ngModel)]="formdata.address"></ion-input>
         </ion-item>

        <ion-item>
          <ion-label stacked>Teléfono</ion-label>
          <ion-input type="tel" [(ngModel)]="formdata.phone"></ion-input>
        </ion-item>

      </ion-list>
    </div>
  </div>
  <div>
    <ion-item>
      <ion-label>¿Tienes un cupón?</ion-label>
      <ion-checkbox color="dark" checked="true" [(ngModel)]="hasVoucher" [disabled]='_flagVoucher'></ion-checkbox>
    </ion-item>
    <div style="display: flex">
      <ion-item *ngIf="hasVoucher"> 
          <ion-label>cupón</ion-label>
          <ion-input type="password" [(ngModel)]="keyVoucher" [disabled]='_flagVoucher'></ion-input>
      </ion-item>
      <button *ngIf="hasVoucher" ion-button color="secondary" (click)='validateVoucher(keyVoucher)' style="margin: 0px; height: 48px; width: 48px;" [disabled]='_flagVoucher'>
        <ion-icon name="checkmark"></ion-icon>
      </button>     
    </div>
  </div>
  <div padding style="display: flex;">
      <div style="margin-right: 30px;">
        <p>Subtotal:</p>
        <p *ngIf="points" class="blue">Puntos:</p>
        <p *ngIf="discount" class="blue">Discount:</p>        
        <p *ngIf="deliveryCost">Domiciliio:</p>
        <p>TOTAL:</p>
      </div>
      <!-- TODO costo de envio -->
      <div>
        <p><strong>$ {{ cartService.totalPrice() | number:'3.2'}}</strong></p>
        <p *ngIf="points" class="blue"><strong>- $ {{ points | number:'3.2'}}</strong></p>
        <p *ngIf="discount" class="blue"><strong>- $ {{ discount | number:'3.2'}}</strong></p>        
        <p *ngIf="deliveryCost"><strong>$ {{5000 | number:'3.2'}}</strong></p>        
        <p><strong>$ {{ cartService.totalPrice() - points - discount + deliveryCost | number:'3.2'}}</strong></p>        
      </div>
  </div>

  <button ion-button block (click)="validateData(false)" color="secondary" [disabled]='(cartService.totalPrice()+deliveryCost-this.discount-this.points) < 10000'>
    Pagar en Linea
  </button>
  <p *ngIf="(cartService.totalPrice()+deliveryCost-this.discount-this.points) < 10000">Para poder pagar en línea debes tener un monto mayor o igual a COP$ 10.000. Debes tener en cuenta que si estas pagando con puntos este valor no se incluye en el monto.</p>
  <button *ngIf='_flagContraentrega' ion-button block (click)="validateData(true)" color="secondary">
    Pago contra entrega
  </button>
  <ion-label>* Los pagos contra entrega solo aplican para Bogotá, Manizales, Tunja </ion-label>

  <button class="testPay" ion-button block (click)="validateData(false, true)" color="secondary">
    {{ "Continuar test" }}
  </button>
</ion-content>
